---
import BaseLayout from '../../layouts/base.astro';
import StoreListing from '../../components/frontend/StoreListing.astro';
import StoreTags from '../../components/frontend/StoreTags.astro';
import SiteFooter from '../../components/frontend/SiteFooter.astro';
import type { Store } from '../../shared/types';

export const prerender = true;

export const getStaticPaths = async () => {
  const response = await fetch(import.meta.env.PUBLIC_API_URL + '/api/places');

  const stores: Store[] = await response.json();
  return stores.map((store) => ({
    params: {
      slug: store.slug
    },
    props: { store: store }
  }));
};
const { store } = Astro.props;

const description = store.longDescription || store.description;
const metaDescription =
  store.description && store.description.length > 25
    ? `${store.description}`
    : `${store.name} at bookstore.guide, your directory of San Francisco book sellers.`;
---

<BaseLayout
  canonical={`https://bookstore.guide/store/${store.slug}/`}
  description={metaDescription}
  title={`${store.name} at the San Francisco Bookstore Guide`}>
  <h1>{store.name}</h1>
  <div class="content">
    <StoreListing store={store} description={description} />
    <StoreTags tags={store.traits} />
  </div>
  <SiteFooter />
</BaseLayout>
